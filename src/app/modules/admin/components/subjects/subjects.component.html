<div class="subject-management">
  <div class="section-header">
    <h1>Subject Management</h1>
    <p>Manage and organize subjects for the system</p>
  </div>
  
  <div class="filter-bar">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="searchTerm" 
        (keyup.enter)="onSearch()" 
        placeholder="Search by name, code, or description"
      />
      <button class="search-button" (click)="onSearch()" aria-label="Search subjects">
        <i class="fas fa-search"></i>
      </button>
    </div>
    
    <div class="filter-actions">
      <div class="status-filter" (click)="toggleStatusDropdown($event)">
        <span>{{ selectedStatus }}</span>
        <i class="fas fa-chevron-down"></i>
        
        <div class="status-dropdown" *ngIf="showStatusDropdown">
          <div class="status-option" (click)="selectStatus('All Statuses')">All Statuses</div>
          <div class="status-option" (click)="selectStatus('Active')">Active</div>
          <div class="status-option" (click)="selectStatus('Inactive')">Inactive</div>
        </div>
      </div>
      
      <button class="add-button" (click)="openAddSubjectModal()">
        <i class="fas fa-plus"></i> Add Subject
      </button>
    </div>
  </div>
  
  <div class="loading-state" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading subjects...</p>
  </div>
  
  <div class="error-state" *ngIf="error && !isLoading">
    <p>{{ error }}</p>
    <button (click)="loadSubjects()">Retry</button>
  </div>
  
  <div class="empty-state" *ngIf="!isLoading && !error && filteredSubjects.length === 0">
    <p>No subjects found matching your criteria.</p>
    <button *ngIf="searchTerm || selectedStatus !== 'All Statuses'" (click)="searchTerm = ''; selectedStatus = 'All Statuses'; loadSubjects()">Reset Filters</button>
  </div>
  
  <div class="data-table" *ngIf="!isLoading && !error && filteredSubjects.length > 0">
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Code</th>
          <th>Credits</th>
          <th>Description</th>
          <th>Status</th>
          <th>Created At</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let subject of filteredSubjects">
          <td>{{ subject.name }}</td>
          <td>{{ subject.code }}</td>
          <td>{{ subject.credits }}</td>
          <td class="description-cell">{{ subject.description }}</td>
          <td>
            <span class="badge" [ngClass]="subject.isActive ? 'badge-success' : 'badge-danger'">
              {{ subject.isActive ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>{{ subject.createdAt | date:'MMM d, y' }}</td>
          <td class="action-buttons">
            <button class="action-btn" (click)="toggleActionMenu(subject.id, $event)" aria-label="Open actions menu">
              <i class="fas fa-ellipsis-v"></i>
            </button>
            
            <div class="action-menu" *ngIf="activeActionMenu === subject.id" [class.flip-up]="flipUpMenuIds.has(subject.id)">
              <div class="action-item" (click)="viewSubject(subject.id, $event)">
                <i class="fas fa-eye"></i> View
              </div>
              <div class="action-item" (click)="editSubject(subject.id, $event)">
                <i class="fas fa-edit"></i> Edit
              </div>
              <div 
                class="action-item" 
                [class.activate]="!subject.isActive" 
                [class.deactivate]="subject.isActive" 
                (click)="toggleSubjectStatus(subject.id, $event)"
              >
                <i class="fas" [ngClass]="subject.isActive ? 'fa-ban' : 'fa-check-circle'"></i>
                {{ subject.isActive ? 'Deactivate' : 'Activate' }}
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Add Subject Modal Component -->
<app-add-subject-modal 
  *ngIf="showAddSubjectModal"
  (close)="closeAddSubjectModal($event)"
></app-add-subject-modal>

<!-- View Subject Modal Component -->
<app-view-subject-modal
  *ngIf="showViewSubjectModal"
  [subject]="selectedSubject"
  (close)="closeViewSubjectModal()"
></app-view-subject-modal>

<!-- Edit Subject Modal Component -->
<app-edit-subject-modal
  *ngIf="showEditSubjectModal"
  [subject]="selectedSubject"
  (close)="closeEditSubjectModal($event)"
></app-edit-subject-modal> 